

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>HEWL S-SAD Merging Statistics &mdash; reciprocalspaceship 0.9.14 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
  <link rel="stylesheet" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/rs-favicon_32x32.png"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Merging with a Robust Error Model" href="3_mergingerrormodel.html" />
    <link rel="prev" title="Basics" href="1_basics.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> reciprocalspaceship
          

          
            
            <img src="../_static/rs.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../userguide/index.html">User Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../userguide/overview.html">Overview and Goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/installation.html">Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="0_quickstart.html">Quickstart</a></li>
<li class="toctree-l2"><a class="reference internal" href="../userguide/mtzdtypes.html">MTZ Data Types</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../userguide/examples.html">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="1_basics.html">Basics</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">HEWL S-SAD Merging Statistics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Load-scaled,-unmerged-data">Load scaled, unmerged data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Merging-with-Inverse-Variance-Weights">Merging with Inverse-Variance Weights</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Merging-with-2-fold-Cross-Validation">Merging with 2-fold Cross-Validation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Merge-HEWL-data">Merge HEWL data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Compute-CC_{1/2}-and-CC_{anom}">Compute <span class="math notranslate nohighlight">\(CC_{1/2}\)</span> and <span class="math notranslate nohighlight">\(CC_{anom}\)</span></a></li>
<li class="toctree-l4"><a class="reference internal" href="#Summary">Summary</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="3_mergingerrormodel.html">Merging with a Robust Error Model</a></li>
<li class="toctree-l3"><a class="reference internal" href="4_anomalousmap.html">Anomalous Difference Map</a></li>
<li class="toctree-l3"><a class="reference internal" href="5_anomaloussites.html">Anomalous Differences in Real Space</a></li>
<li class="toctree-l3"><a class="reference internal" href="6_timeresolvedPYP.html">Time-Resolved Difference Map</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/index.html">For Developers</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">reciprocalspaceship</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../userguide/index.html">User Guide</a> &raquo;</li>
        
          <li><a href="../userguide/examples.html">Examples</a> &raquo;</li>
        
      <li>HEWL S-SAD Merging Statistics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/examples/2_mergingstats.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
  This page was generated from
  <a class="reference external" href="https://github.com/Hekstra-Lab/reciprocalspaceship/blob/main/docs/examples/2_mergingstats.ipynb">docs/examples/2_mergingstats.ipynb</a>.
  Interactive online version:
  <span style="white-space: nowrap;">
    <a href="https://mybinder.org/v2/gh/Hekstra-Lab/reciprocalspaceship/main?filepath=docs/examples/2_mergingstats.ipynb?urlpath=lab">
    <img alt="Binder badge" src="https://mybinder.org/badge_logo.svg" style="vertical-align:text-bottom"></a>.
  </span>
</div><div class="section" id="HEWL-S-SAD-Merging-Statistics">
<h1>HEWL S-SAD Merging Statistics<a class="headerlink" href="#HEWL-S-SAD-Merging-Statistics" title="Permalink to this headline">¶</a></h1>
<p>Merging statistics are a useful means to assess data quality in crystallography. However, each statistic has inherent shortcomings. For example, R-merge will appear inflated if the multiplicity is high, and the Pearson correlation coefficients used for <span class="math notranslate nohighlight">\(CC_{1/2}\)</span> are very sensitive to outliers.</p>
<p>Most scaling and merging programs output multiple merging statistics to get around these shortcomings. However, one can imagine that it could also be useful to customize certain parameters, such as how many resolution bins are used. Or, perhaps a better statistic will be developed that is worth implementing.</p>
<p>In this notebook, <code class="docutils literal notranslate"><span class="pre">reciprocalspaceship</span></code> is used to compute half-dataset correlation coefficients (<span class="math notranslate nohighlight">\(CC_{1/2}\)</span> and <span class="math notranslate nohighlight">\(CC_{anom}\)</span>) for a dataset collected from a tetragonal hen egg-white lysozyme (HEWL) crystal at 6550 eV. These data are unmerged, but were scaled in AIMLESS. They contain sufficient sulfur anomalous signal to determine a solution by the SAD method. This illustrates the use of <code class="docutils literal notranslate"><span class="pre">rs</span></code> to implement a merging routine, create a custom analysis, and could be useful as a
template for other exploratory crystallographic data analyses. As an example, we will compare half-dataset correlations computed using both Pearson and Spearman correlation coefficients.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="s2">&quot;notebook&quot;</span><span class="p">,</span> <span class="n">font_scale</span><span class="o">=</span><span class="mf">1.3</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">reciprocalspaceship</span> <span class="k">as</span> <span class="nn">rs</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">rs</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0.9.9
</pre></div></div>
</div>
<hr class="docutils" />
<div class="section" id="Load-scaled,-unmerged-data">
<h2>Load scaled, unmerged data<a class="headerlink" href="#Load-scaled,-unmerged-data" title="Permalink to this headline">¶</a></h2>
<p>This data has been scaled in AIMLESS. The data includes the image number and the scaled <strong>I</strong> and <strong>SIGI</strong> values.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hewl</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">read_mtz</span><span class="p">(</span><span class="s2">&quot;data/HEWL_unmerged.mtz&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">hewl</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>BATCH</th>
      <th>I</th>
      <th>SIGI</th>
      <th>PARTIAL</th>
    </tr>
    <tr>
      <th>H</th>
      <th>K</th>
      <th>L</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">0</th>
      <th rowspan="5" valign="top">0</th>
      <th>4</th>
      <td>137</td>
      <td>696.5212</td>
      <td>87.83294</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>520</td>
      <td>710.6812</td>
      <td>88.107025</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>856</td>
      <td>672.05634</td>
      <td>87.75671</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1239</td>
      <td>642.47485</td>
      <td>87.90302</td>
      <td>False</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2160</td>
      <td>655.71783</td>
      <td>87.74394</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of observed reflections: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">hewl</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Number of observed reflections: 816804
</pre></div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Merging-with-Inverse-Variance-Weights">
<h2>Merging with Inverse-Variance Weights<a class="headerlink" href="#Merging-with-Inverse-Variance-Weights" title="Permalink to this headline">¶</a></h2>
<p>Since the input data are unmerged, we will implement the inverse-variance weighting scheme used by AIMLESS to merge the observations. The weighted average is a better estimator of the true mean than the raw average, and this weighting scheme corresponds to the maximum likelihood estimator of the true mean if we assume that the observations are normally-distributed about the true mean.</p>
<p>The merged intensity for each reflection, <span class="math notranslate nohighlight">\(I_h\)</span>, can be determined from the observed intensities, <span class="math notranslate nohighlight">\(I_{h,i}\)</span>, and error estimates, <span class="math notranslate nohighlight">\(\sigma_{h,i}\)</span>, as follows:</p>
<p><span class="math">\begin{equation}
I_h = \frac{\sum_{i}w_{h,i} I_{h,i}}{\sum_{i} w_{h,i}}
\end{equation}</span></p>
<p>where the weight for each observation, <span class="math notranslate nohighlight">\(w_{h,i}\)</span> is given by:</p>
<p><span class="math">\begin{equation}
w_{h,i} = \frac{1}{(\sigma_{h,i})^2}
\end{equation}</span></p>
<p>The updated estimate of the uncertainty, <span class="math notranslate nohighlight">\(\sigma_{h}\)</span>, is given by:</p>
<p><span class="math">\begin{equation}
\sigma_{h} = \sqrt{\frac{1}{\sum_{i} w_{h,i}}}
\end{equation}</span></p>
<p>Let’s start by implementing the above equations in a function that will compute the merged <span class="math notranslate nohighlight">\(I_h\)</span> and <span class="math notranslate nohighlight">\(\sigma_h\)</span>. We will use the <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/user_guide/groupby.html">Pandas groupby</a> methods to apply this function across the unique Miller indices in the <code class="docutils literal notranslate"><span class="pre">DataSet</span></code>. If we group Friedel pairs together, we will refer to the quantity as <strong>IMEAN</strong>, and if we keep the Friedel pairs separate we will refer to the quantities as <strong>I(+)</strong> and <strong>I(-)</strong>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">anomalous</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge dataset using inverse-variance weights.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    dataset : rs.DataSet</span>
<span class="sd">        DataSet to be merged containing scaled I and SIGI</span>
<span class="sd">    anomalous : bool</span>
<span class="sd">        If True, I(+) and I(-) will be reported. If False,</span>
<span class="sd">        IMEAN will be reported</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    rs.DataSet</span>
<span class="sd">        Merged DataSet object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">hkl_to_asu</span><span class="p">(</span><span class="n">anomalous</span><span class="o">=</span><span class="n">anomalous</span><span class="p">)</span>
    <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>  <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;SIGI&#39;</span><span class="p">]</span><span class="o">**-</span><span class="mi">2</span>
    <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;wI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;H&quot;</span><span class="p">,</span> <span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;L&quot;</span><span class="p">])</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">g</span><span class="p">[[</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="s2">&quot;wI&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;wI&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;SIGI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">])</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">,</span> <span class="s2">&quot;SIGI&quot;</span><span class="p">]]</span>
    <span class="n">result</span><span class="o">.</span><span class="n">merged</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">anomalous</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">unstack_anomalous</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">anomalous=False</span></code>, this function can be used to compute <strong>IMEAN</strong> and <strong>SIGIMEAN</strong> by including both Friedel pairs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result1</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">hewl</span><span class="p">,</span> <span class="n">anomalous</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result1</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>I</th>
      <th>SIGI</th>
    </tr>
    <tr>
      <th>H</th>
      <th>K</th>
      <th>L</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>23</th>
      <th>22</th>
      <th>9</th>
      <td>1349.8007</td>
      <td>22.878157</td>
    </tr>
    <tr>
      <th>37</th>
      <th>19</th>
      <th>0</th>
      <td>260.0996</td>
      <td>9.075029</td>
    </tr>
    <tr>
      <th>17</th>
      <th>11</th>
      <th>15</th>
      <td>146.02324</td>
      <td>2.895325</td>
    </tr>
    <tr>
      <th>35</th>
      <th>1</th>
      <th>14</th>
      <td>9.629998</td>
      <td>3.902024</td>
    </tr>
    <tr>
      <th>15</th>
      <th>5</th>
      <th>18</th>
      <td>7.837115</td>
      <td>1.039951</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">anomalous=True</span></code>, this function can be used to compute <strong>I(+)</strong>, <strong>SIGI(+)</strong>, <strong>I(-)</strong>, and <strong>SIGI(-)</strong> by separating Friedel pairs:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result2</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="n">hewl</span><span class="p">,</span> <span class="n">anomalous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result2</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>I(+)</th>
      <th>SIGI(+)</th>
      <th>SIGI(-)</th>
      <th>I(-)</th>
    </tr>
    <tr>
      <th>H</th>
      <th>K</th>
      <th>L</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20</th>
      <th>4</th>
      <th>7</th>
      <td>790.00696</td>
      <td>13.43943</td>
      <td>13.45224</td>
      <td>819.43054</td>
    </tr>
    <tr>
      <th>21</th>
      <th>15</th>
      <th>16</th>
      <td>51.543583</td>
      <td>2.840802</td>
      <td>2.675156</td>
      <td>50.629883</td>
    </tr>
    <tr>
      <th>35</th>
      <th>8</th>
      <th>12</th>
      <td>56.64869</td>
      <td>2.762924</td>
      <td>2.779431</td>
      <td>52.87201</td>
    </tr>
    <tr>
      <th>16</th>
      <th>16</th>
      <th>15</th>
      <td>517.4729</td>
      <td>11.513449</td>
      <td>11.513449</td>
      <td>517.4729</td>
    </tr>
    <tr>
      <th>33</th>
      <th>23</th>
      <th>3</th>
      <td>101.954094</td>
      <td>3.753756</td>
      <td>3.605523</td>
      <td>89.131714</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>A variant of the above function is implemented in <code class="docutils literal notranslate"><span class="pre">rs.algorithms</span></code>, and we will use that implementation in the next section for computing merging statistics. This function computes <strong>IMEAN</strong>, <strong>I(+)</strong>, <strong>I(-)</strong>, and associated uncertainties for each unique Miller index.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result3</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">hewl</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">result3</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>IMEAN</th>
      <th>SIGIMEAN</th>
      <th>I(+)</th>
      <th>SIGI(+)</th>
      <th>I(-)</th>
      <th>SIGI(-)</th>
      <th>N(+)</th>
      <th>N(-)</th>
    </tr>
    <tr>
      <th>H</th>
      <th>K</th>
      <th>L</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>38</th>
      <th>10</th>
      <th>4</th>
      <td>454.0382</td>
      <td>11.617793</td>
      <td>416.8525</td>
      <td>21.370535</td>
      <td>469.6386</td>
      <td>13.841894</td>
      <td>8</td>
      <td>20</td>
    </tr>
    <tr>
      <th>17</th>
      <th>9</th>
      <th>15</th>
      <td>101.308815</td>
      <td>2.1820927</td>
      <td>100.45327</td>
      <td>3.0412343</td>
      <td>102.21658</td>
      <td>3.1326878</td>
      <td>32</td>
      <td>31</td>
    </tr>
    <tr>
      <th>38</th>
      <th>7</th>
      <th>8</th>
      <td>4.571434</td>
      <td>0.9255639</td>
      <td>4.8481956</td>
      <td>1.2750458</td>
      <td>4.2631493</td>
      <td>1.3457003</td>
      <td>20</td>
      <td>20</td>
    </tr>
    <tr>
      <th>11</th>
      <th>5</th>
      <th>5</th>
      <td>3991.629</td>
      <td>47.690647</td>
      <td>4061.3477</td>
      <td>66.316765</td>
      <td>3916.9563</td>
      <td>68.63234</td>
      <td>60</td>
      <td>56</td>
    </tr>
    <tr>
      <th>27</th>
      <th>18</th>
      <th>11</th>
      <td>14.8991</td>
      <td>1.0327507</td>
      <td>10.999734</td>
      <td>1.4392322</td>
      <td>19.038132</td>
      <td>1.4828024</td>
      <td>20</td>
      <td>20</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Merging-with-2-fold-Cross-Validation">
<h2>Merging with 2-fold Cross-Validation<a class="headerlink" href="#Merging-with-2-fold-Cross-Validation" title="Permalink to this headline">¶</a></h2>
<p>To compute correlation coefficients we will repeatedly split our data into half-datasets. We will do this by randomly splitting the data using the image number. These half-datasets will be merged independently and used to determine uncertainties in the correlation coefficients. We will first write a method to randomly split our data, and then we will then write a method that automates the sampling and merging of multiple half-datasets.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">sample_halfdatasets</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Randomly split DataSet into two equal halves by BATCH&quot;&quot;&quot;</span>
    <span class="n">batch</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
    <span class="n">halfbatch1</span><span class="p">,</span> <span class="n">halfbatch2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">half1</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">halfbatch1</span><span class="p">)]</span>
    <span class="n">half2</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">data</span><span class="o">.</span><span class="n">BATCH</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">halfbatch2</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">half1</span><span class="p">,</span> <span class="n">half2</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">def</span> <span class="nf">merge_dataset</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">nsamples</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Merge DataSet using inverse-variance weighting scheme. This represents the</span>
<span class="sd">    maximum-likelihood estimator of the mean of the observed intensities assuming</span>
<span class="sd">    they are independent and normally distributed with the same mean.</span>

<span class="sd">    Sample means across half-datasets can be used to compute the merging statistics CC1/2 and CCanom.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">dataset</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nsamples</span><span class="p">):</span>
        <span class="n">half1</span><span class="p">,</span> <span class="n">half2</span> <span class="o">=</span> <span class="n">sample_halfdatasets</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">mergedhalf1</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">half1</span><span class="p">)</span>
        <span class="n">mergedhalf2</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">algorithms</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">half2</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">mergedhalf1</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">mergedhalf2</span><span class="p">,</span> <span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">result</span><span class="p">[</span><span class="s2">&quot;sample&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">rs</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Merge-HEWL-data">
<h2>Merge HEWL data<a class="headerlink" href="#Merge-HEWL-data" title="Permalink to this headline">¶</a></h2>
<p>We will now merge the HEWL data, repeatedly sampling across half-datasets in order to assess the distribution of correlation coefficients.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># This cell takes a few minutes with nsamples=15</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">merge_dataset</span><span class="p">(</span><span class="n">hewl</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">merged</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th>IMEAN1</th>
      <th>SIGIMEAN1</th>
      <th>I(+)1</th>
      <th>SIGI(+)1</th>
      <th>I(-)1</th>
      <th>SIGI(-)1</th>
      <th>N(+)1</th>
      <th>N(-)1</th>
      <th>IMEAN2</th>
      <th>SIGIMEAN2</th>
      <th>I(+)2</th>
      <th>SIGI(+)2</th>
      <th>I(-)2</th>
      <th>SIGI(-)2</th>
      <th>N(+)2</th>
      <th>N(-)2</th>
      <th>sample</th>
    </tr>
    <tr>
      <th>H</th>
      <th>K</th>
      <th>L</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">0</th>
      <th rowspan="5" valign="top">0</th>
      <th>4</th>
      <td>657.99817</td>
      <td>43.882294</td>
      <td>657.99817</td>
      <td>43.882294</td>
      <td>657.99817</td>
      <td>43.882294</td>
      <td>4</td>
      <td>4</td>
      <td>662.40204</td>
      <td>25.35386</td>
      <td>662.40204</td>
      <td>25.353859</td>
      <td>662.40204</td>
      <td>25.353859</td>
      <td>12</td>
      <td>12</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>645.79663</td>
      <td>43.884262</td>
      <td>645.79663</td>
      <td>43.884266</td>
      <td>645.79663</td>
      <td>43.884266</td>
      <td>4</td>
      <td>4</td>
      <td>666.4745</td>
      <td>25.35348</td>
      <td>666.4745</td>
      <td>25.35348</td>
      <td>666.4745</td>
      <td>25.35348</td>
      <td>12</td>
      <td>12</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>662.0198</td>
      <td>25.348951</td>
      <td>662.0198</td>
      <td>25.348951</td>
      <td>662.0198</td>
      <td>25.348951</td>
      <td>12</td>
      <td>12</td>
      <td>659.13995</td>
      <td>43.907776</td>
      <td>659.13995</td>
      <td>43.907776</td>
      <td>659.13995</td>
      <td>43.907776</td>
      <td>4</td>
      <td>4</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>660.4694</td>
      <td>33.18889</td>
      <td>660.4694</td>
      <td>33.18889</td>
      <td>660.4694</td>
      <td>33.18889</td>
      <td>7</td>
      <td>7</td>
      <td>661.946</td>
      <td>29.271538</td>
      <td>661.946</td>
      <td>29.271538</td>
      <td>661.946</td>
      <td>29.271538</td>
      <td>9</td>
      <td>9</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>666.3023</td>
      <td>24.359608</td>
      <td>666.3023</td>
      <td>24.35961</td>
      <td>666.3023</td>
      <td>24.35961</td>
      <td>13</td>
      <td>13</td>
      <td>639.66833</td>
      <td>50.654987</td>
      <td>639.66833</td>
      <td>50.654987</td>
      <td>639.66833</td>
      <td>50.654987</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">45</th>
      <th rowspan="5" valign="top">10</th>
      <th>2</th>
      <td>30.170218</td>
      <td>7.3511124</td>
      <td>30.170218</td>
      <td>7.3511124</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>0</td>
      <td>15.318142</td>
      <td>3.9687188</td>
      <td>15.318142</td>
      <td>3.9687188</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3</td>
      <td>0</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7.669444</td>
      <td>6.6297607</td>
      <td>7.669444</td>
      <td>6.6297607</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>0</td>
      <td>22.89468</td>
      <td>4.1084785</td>
      <td>22.89468</td>
      <td>4.1084785</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3</td>
      <td>0</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>11.665072</td>
      <td>5.2794247</td>
      <td>11.665072</td>
      <td>5.2794247</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2</td>
      <td>0</td>
      <td>24.119883</td>
      <td>4.656634</td>
      <td>24.119883</td>
      <td>4.656634</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>2</td>
      <td>0</td>
      <td>11</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7.669444</td>
      <td>6.6297607</td>
      <td>7.669444</td>
      <td>6.6297607</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>0</td>
      <td>22.89468</td>
      <td>4.1084785</td>
      <td>22.89468</td>
      <td>4.1084785</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3</td>
      <td>0</td>
      <td>12</td>
    </tr>
    <tr>
      <th>2</th>
      <td>17.961912</td>
      <td>4.288131</td>
      <td>17.961912</td>
      <td>4.288131</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>3</td>
      <td>0</td>
      <td>20.064919</td>
      <td>6.0180674</td>
      <td>20.064919</td>
      <td>6.0180674</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>0</td>
      <td>13</td>
    </tr>
  </tbody>
</table>
<p>187364 rows × 17 columns</p>
</div></div>
</div>
</div>
<hr class="docutils" />
<div class="section" id="Compute-CC_{1/2}-and-CC_{anom}">
<h2>Compute <span class="math notranslate nohighlight">\(CC_{1/2}\)</span> and <span class="math notranslate nohighlight">\(CC_{anom}\)</span><a class="headerlink" href="#Compute-CC_{1/2}-and-CC_{anom}" title="Permalink to this headline">¶</a></h2>
<p>We will first assign each reflection to a resolution bin and then we will compute the correlation coefficients</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">merged</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">assign_resolution_bins</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">groupby1</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">])[[</span><span class="s2">&quot;IMEAN1&quot;</span><span class="p">,</span> <span class="s2">&quot;IMEAN2&quot;</span><span class="p">]]</span>
<span class="n">pearson1</span> <span class="o">=</span> <span class="n">groupby1</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="s2">&quot;IMEAN1&quot;</span><span class="p">,</span> <span class="s2">&quot;IMEAN2&quot;</span><span class="p">)]</span>
<span class="n">pearson1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Pearson&quot;</span>
<span class="n">spearman1</span> <span class="o">=</span> <span class="n">groupby1</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;spearman&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="s2">&quot;IMEAN1&quot;</span><span class="p">,</span> <span class="s2">&quot;IMEAN2&quot;</span><span class="p">)]</span>
<span class="n">spearman1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Spearman&quot;</span>
<span class="n">results1</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pearson1</span><span class="p">,</span> <span class="n">spearman1</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">results1</span> <span class="o">=</span> <span class="n">results1</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results1</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Pearson</th>
      <th colspan="2" halign="left">Spearman</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>mean</th>
      <th>std</th>
    </tr>
    <tr>
      <th>bin</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.997334</td>
      <td>0.000316</td>
      <td>0.998895</td>
      <td>0.000063</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.997958</td>
      <td>0.000360</td>
      <td>0.999363</td>
      <td>0.000066</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.998971</td>
      <td>0.000306</td>
      <td>0.999678</td>
      <td>0.000023</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.999297</td>
      <td>0.000102</td>
      <td>0.999658</td>
      <td>0.000024</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.999368</td>
      <td>0.000147</td>
      <td>0.999687</td>
      <td>0.000022</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">results1</span><span class="p">[(</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)],</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">results1</span><span class="p">[(</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">)],</span>
             <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#1b9e77&quot;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$CC_{1/2}$ (Pearson)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">results1</span><span class="p">[(</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)],</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">results1</span><span class="p">[(</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">)],</span>
             <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#d95f02&quot;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$CC_{1/2}$ (Spearman)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Correlation Coefficient&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Resolution Bin ($\AA$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_2_mergingstats_29_0.png" src="../_images/examples_2_mergingstats_29_0.png" />
</div>
</div>
<p>It is important to note the scale on the y-axis – this dataset is edge-limited, and as such the <span class="math notranslate nohighlight">\(CC_{1/2}\)</span> is very high across all resolution bins. The Spearman CC appears higher across all resolution bins except at high resolution, and overall has a lower standard deviation among samples. This is consistent with our expectation that Spearman CCs are a more robust estimator of correlation than Pearson CCs.</p>
<p>Let’s now repeat this for the anomalous data, computing <span class="math notranslate nohighlight">\(CC_{anom}\)</span>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;ANOM1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;I(+)1&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;I(-)1&quot;</span><span class="p">]</span>
<span class="n">merged</span><span class="p">[</span><span class="s2">&quot;ANOM2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;I(+)2&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;I(-)2&quot;</span><span class="p">]</span>

<span class="c1"># Similar to CChalf, but we will only look at acentric reflections</span>
<span class="n">groupby2</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">acentrics</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;sample&quot;</span><span class="p">,</span> <span class="s2">&quot;bin&quot;</span><span class="p">])[[</span><span class="s2">&quot;ANOM1&quot;</span><span class="p">,</span> <span class="s2">&quot;ANOM2&quot;</span><span class="p">]]</span>
<span class="n">pearson2</span> <span class="o">=</span> <span class="n">groupby2</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;pearson&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="s2">&quot;ANOM1&quot;</span><span class="p">,</span> <span class="s2">&quot;ANOM2&quot;</span><span class="p">)]</span>
<span class="n">pearson2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Pearson&quot;</span>
<span class="n">spearman2</span> <span class="o">=</span> <span class="n">groupby2</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;spearman&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="p">(</span><span class="s2">&quot;ANOM1&quot;</span><span class="p">,</span> <span class="s2">&quot;ANOM2&quot;</span><span class="p">)]</span>
<span class="n">spearman2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Spearman&quot;</span>
<span class="n">results2</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pearson2</span><span class="p">,</span> <span class="n">spearman2</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">results2</span> <span class="o">=</span> <span class="n">results2</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bin&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">results2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Pearson</th>
      <th colspan="2" halign="left">Spearman</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>std</th>
      <th>mean</th>
      <th>std</th>
    </tr>
    <tr>
      <th>bin</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.422196</td>
      <td>0.037998</td>
      <td>0.497923</td>
      <td>0.029704</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.233349</td>
      <td>0.061975</td>
      <td>0.328263</td>
      <td>0.023917</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.357182</td>
      <td>0.051746</td>
      <td>0.444657</td>
      <td>0.029250</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.484710</td>
      <td>0.045454</td>
      <td>0.543314</td>
      <td>0.031731</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.579058</td>
      <td>0.023952</td>
      <td>0.611739</td>
      <td>0.020141</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">results2</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">results2</span><span class="p">[(</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)],</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">results2</span><span class="p">[(</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">)],</span>
             <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#1b9e77&quot;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$CC_</span><span class="si">{anom}</span><span class="s2">$ (Pearson)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">results2</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">results2</span><span class="p">[(</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)],</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">results2</span><span class="p">[(</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">)],</span>
             <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#d95f02&quot;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$CC_</span><span class="si">{anom}</span><span class="s2">$ (Spearman)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">results2</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Correlation Coefficient&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Resolution Bin ($\AA$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_2_mergingstats_33_0.png" src="../_images/examples_2_mergingstats_33_0.png" />
</div>
</div>
<p>There is significant anomalous signal across all but the highest resolution bins. The Spearman CCs have smaller error bars than the corresponding Pearson CCs and the Spearman CCs are also higher in most bins. These differences highlight the influence of outlier measurements on the different correlation coefficients.</p>
</div>
<hr class="docutils" />
<div class="section" id="Summary">
<h2>Summary<a class="headerlink" href="#Summary" title="Permalink to this headline">¶</a></h2>
<p>We have used <code class="docutils literal notranslate"><span class="pre">reciprocalspaceship</span></code> to merge a dataset using inverse-variance weights. As part of this analysis, we performed repeated 2-fold cross-validation to compute Pearson and Spearman correlation coefficients and associated uncertainties. This relatively simple procedure to obtain uncertainty estimates for correlation coefficients is seldom done when analyzing merging quality. However, we can see that the standard deviation for computed correlation coefficients can be nearly
<span class="math notranslate nohighlight">\(\pm0.1\)</span> for quantities such as <span class="math notranslate nohighlight">\(CC_{anom}\)</span>. This is worth keeping in mind when analyzing SAD experiments because this dataset is very high quality (edge-limited) when one considers the <span class="math notranslate nohighlight">\(CC_{1/2}\)</span>. Putting these two correlation coefficients on the same axes emphasizes this point:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">results1</span><span class="p">[(</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)],</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">results1</span><span class="p">[(</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">)],</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#1b9e77&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$CC_{1/2}$ (Pearson)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">results1</span><span class="p">[(</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)],</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">results1</span><span class="p">[(</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">)],</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#d95f02&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$CC_{1/2}$ (Spearman)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">results2</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">results2</span><span class="p">[(</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)],</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">results2</span><span class="p">[(</span><span class="s2">&quot;Pearson&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">)],</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#1b9e77&#39;</span><span class="p">,</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$CC_</span><span class="si">{anom}</span><span class="s2">$ (Pearson)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">results2</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">results2</span><span class="p">[(</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">)],</span>
             <span class="n">yerr</span><span class="o">=</span><span class="n">results2</span><span class="p">[(</span><span class="s2">&quot;Spearman&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">)],</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#d95f02&#39;</span><span class="p">,</span>
             <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$CC_</span><span class="si">{anom}</span><span class="s2">$ (Spearman)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Correlation Coefficient&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;Resolution Bin ($\AA$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_2_mergingstats_36_0.png" src="../_images/examples_2_mergingstats_36_0.png" />
</div>
</div>
<p>Even a simple change to the procedure for computing merging statistics, such as substituting a Spearman correlation coefficient for a Pearson one, can alter the apparent quality of a dataset. By lowering the barrier to implementing new analyses, we hope that <code class="docutils literal notranslate"><span class="pre">reciprocalspaceship</span></code> can encourage the development of more robust indicators of crystallographic data quality.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="3_mergingerrormodel.html" class="btn btn-neutral float-right" title="Merging with a Robust Error Model" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="1_basics.html" class="btn btn-neutral float-left" title="Basics" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2020, Jack B. Greisman, Kevin M. Dalton.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>